[gd_scene load_steps=2 format=3 uid="uid://bah64tfi8uv0h"]

[sub_resource type="GDScript" id="GDScript_vt3rc"]
script/source = "@tool
extends ConfirmationDialog

var scene_tree: Tree
var current_selected_signal: String
var operation_node:Node3D

signal signal_selected(signal_nema: String)

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	#theme =  EditorInterface.get_editor_theme()
	
	var vbox = VBoxContainer.new()
	add_child(vbox)
	
	scene_tree = Tree.new()
	scene_tree.size_flags_vertical = Control.SIZE_EXPAND_FILL
	scene_tree.item_selected.connect(_on_tree_item_selected)
	vbox.add_child(scene_tree)

func _populate_scene_tree():
	var icon =  EditorInterface.get_base_control().get_theme_icon(\"Signal\", \"EditorIcons\")
	
	scene_tree.clear()
	
	var root = scene_tree.create_item()
	root.set_icon(0, EditorInterface.get_base_control().get_theme_icon(operation_node.get_class(), \"EditorIcons\"))
	root.set_text(0, operation_node.name)
	root.set_selectable(0,false)
	
	for sig in operation_node.get_signal_list():
		if sig[\"args\"].size() == 0:
			var item = scene_tree.create_item(root)
			item.set_icon(0, icon)
			item.set_text(0, sig[\"name\"] + \"()\")
			item.set_metadata(0, sig[\"name\"])
		else:
			# 检查是否只有一个参数且类型为AABB
			if sig[\"args\"][0].size() == 1:
				var arg_type = sig[\"args\"][0].values()[0]
				if arg_type == \"AABB\":
					var item = scene_tree.create_item(root)
					item.set_icon(0, icon)
					item.set_text(0, sig[\"name\"] + sig[\"args\"][0].replace(\"{\", \"(\").replace(\"}\", \")\"))
					item.set_metadata(0, sig)

func _on_tree_item_selected():
	var selected = scene_tree.get_selected()
	if selected:
		current_selected_signal = selected.get_metadata(0)
		signal_selected.emit(current_selected_signal)

func _on_select_pressed():
	if current_selected_signal:
		signal_selected.emit(current_selected_signal)
	else :
		signal_selected.emit(\"\")
"

[node name="select_signal" type="ConfirmationDialog"]
oversampling_override = 1.0
script = SubResource("GDScript_vt3rc")

[connection signal="confirmed" from="." to="." method="_on_select_pressed"]
